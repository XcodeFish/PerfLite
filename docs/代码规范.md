# PerfLite代码规范

## 目录

1. [命名规范](#1-命名规范)
2. [代码风格](#2-代码风格)
3. [TypeScript规范](#3-typescript规范)
4. [注释规范](#4-注释规范)
5. [模块规范](#5-模块规范)
6. [性能优化规范](#6-性能优化规范)
7. [WASM开发规范](#7-wasm开发规范)

## 1. 命名规范

### 1.1 命名约定

- **类名**：使用PascalCase（首字母大写）

  ```typescript
  class ErrorParser { }
  ```

- **方法/变量**：使用camelCase（首字母小写）

  ```typescript
  function parseStack() { }
  const errorCount = 0;
  ```

- **常量**：使用UPPER_SNAKE_CASE（全大写下划线）

  ```typescript
  const MAX_RETRY_COUNT = 3;
  ```

- **文件名**：使用kebab-case（小写中划线）

  ```
  error-parser.ts
  ```

- **接口名**：使用PascalCase并以I开头

  ```typescript
  interface IPlugin { }
  ```

- **类型名**：使用PascalCase并以T开头

  ```typescript
  type TConfig = { appId: string };
  ```

### 1.2 命名原则

- 具有描述性，避免使用缩写（除非是常见缩写）
- 方法名应当是动词或动词短语
- 布尔值变量/方法应当使用is/has/can等前缀
- 避免单字母变量名（除了循环计数器）

## 2. 代码风格

### 2.1 基本规则

- 使用2个空格进行缩进
- 每行代码不超过100个字符
- 始终使用分号结束语句
- 使用单引号定义字符串
- 箭头函数参数始终使用括号
- 对象和数组的最后一项后面可以有逗号

### 2.2 代码结构

- 相关的代码应当放在一起
- 将大型函数拆分为小函数
- 避免嵌套过深的代码块（最多3层）
- 使用ES6+语法

## 3. TypeScript规范

### 3.1 类型定义

- 为所有公共API提供类型定义
- 避免使用`any`类型
- 优先使用接口而不是类型别名
- 导出所有公共类型

### 3.2 泛型

- 泛型参数使用有意义的名称
- 限制泛型参数的类型范围

### 3.3 错误处理

- 使用`try-catch`块捕获异常
- 异步函数返回Promise，并在出错时reject
- 避免吞掉错误，始终进行处理或转发

## 4. 注释规范

### 4.1 基本规则

- 所有公共API需要JSDoc注释
- 复杂的代码块需要添加注释
- 避免写显而易见的注释

### 4.2 JSDoc格式

```typescript
/**
 * 解析错误堆栈
 * @param stack - 错误堆栈字符串
 * @returns 解析后的错误信息
 * @throws 如果堆栈字符串格式不正确
 */
function parseStack(stack: string): ErrorInfo { }
```

## 5. 模块规范

### 5.1 导入导出

- 按照字母顺序组织导入语句
- 优先使用命名导出而非默认导出
- 避免通配符导入（`import * as`）

### 5.2 模块组织

- 每个文件只导出一个类或功能组
- 相关功能应当放在同一个目录下
- 避免循环依赖

## 6. 性能优化规范

### 6.1 一般原则

- 避免不必要的计算和内存分配
- 使用缓存减少重复计算
- 懒加载非核心功能

### 6.2 SDK特定优化

- 总体积控制在5KB以内（gzip后）
- 使用Tree Shaking友好的写法
- 避免直接依赖大型库

## 7. WASM开发规范

### 7.1 Rust代码规范

- 遵循Rust官方风格指南
- 使用`cargo fmt`格式化代码
- 使用`cargo clippy`进行静态分析

### 7.2 WASM优化

- 避免大型依赖
- 优先使用SIMD加速
- 导出最小化的接口
